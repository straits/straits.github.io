



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>Introduction - Straits</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.11e41852.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#7cb342">
      
    
    
      <script src="../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="light-green" data-md-color-accent="light-green">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#javascript-traits" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Straits" class="md-header-nav__button md-logo">
          
            <i class="md-icon">strikethrough_s</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Straits
              </span>
              <span class="md-header-nav__topic">
                Introduction
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Straits" class="md-nav__button md-logo">
      
        <i class="md-icon">strikethrough_s</i>
      
    </a>
    Straits
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Introduction
      </label>
    
    <a href="./" title="Introduction" class="md-nav__link md-nav__link--active">
      Introduction
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-few-words-about-javascript-and-modern-languages" title="A few words about JavaScript and modern languages" class="md-nav__link">
    A few words about JavaScript and modern languages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-are-traits" title="What are traits?" class="md-nav__link">
    What are traits?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-do-we-need-traits-an-example" title="Why do we need traits? An example" class="md-nav__link">
    Why do we need traits? An example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-implement-traits-in-javascript" title="How to implement traits in JavaScript" class="md-nav__link">
    How to implement traits in JavaScript
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-better-syntax-for-traits" title="A better syntax for traits" class="md-nav__link">
    A better syntax for traits
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#article-conclusion-and-straits-introduction" title="Article conclusion and straits introduction" class="md-nav__link">
    Article conclusion and straits introduction
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../quickstart/" title="Quickstart" class="md-nav__link">
      Quickstart
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../syntax/" title="Straits syntax" class="md-nav__link">
      Straits syntax
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-few-words-about-javascript-and-modern-languages" title="A few words about JavaScript and modern languages" class="md-nav__link">
    A few words about JavaScript and modern languages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-are-traits" title="What are traits?" class="md-nav__link">
    What are traits?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-do-we-need-traits-an-example" title="Why do we need traits? An example" class="md-nav__link">
    Why do we need traits? An example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-implement-traits-in-javascript" title="How to implement traits in JavaScript" class="md-nav__link">
    How to implement traits in JavaScript
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-better-syntax-for-traits" title="A better syntax for traits" class="md-nav__link">
    A better syntax for traits
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#article-conclusion-and-straits-introduction" title="Article conclusion and straits introduction" class="md-nav__link">
    Article conclusion and straits introduction
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="javascript-traits">JavaScript traits</h1>
<p>Traits are a feature used by most modern languages to implement polymorphism without relying on inheritance.</p>
<p>We'll introduce them, show which problems they would solve in JavaScript, and suggest a way to implement them.
Hope you find it interesting!</p>
<!-- toc -->

<h2 id="a-few-words-about-javascript-and-modern-languages">A few words about JavaScript and modern languages</h2>
<p>JavaScript has been my language of choice for the past 5 years in spite of its <a href="https://www.destroyallsoftware.com/talks/wat">infamous quirks</a>.</p>
<p>It's fast to write, efficient to run, but above all else, it is <em>modern</em>.
The language itself as well as its ecosystem uses great features and solutions, the best ones we know of.</p>
<p>JavaScript supports Object Oriented Programming and uses duck typing to achieve polymorphism. This approach is more powerful and flexible than inheritance, but it still has some major flaws.</p>
<p>A better, more modern way to implement OOP is using traits.
Implementing decent traits in JavaScript through duck typing and prototypal inheritance used to have problems, but since a recent version of the language (ECMAScript 6) added a new primitive data type (<code>symbol</code>), the situation has improved.</p>
<p>Very few are using this exciting feature of the language though, and that's what motivated this article.</p>
<h2 id="what-are-traits">What are traits?</h2>
<p><a href="https://en.wikipedia.org/wiki/Trait_%28computer_programming%29">Traits</a> are a way to add semantics to existing types without risking unintentional interference with existing code.</p>
<p>Traits are an alternative to <a href="https://en.wikipedia.org/wiki/Inheritance_%28object-oriented_programming%29">inheritance</a> as a method for implementing <a href="https://en.wikipedia.org/wiki/Polymorphism_%28computer_science%29">polymorphism</a>, and all the modern languages have them: think of go, haskell and rust just to name a few.</p>
<p>JavaScript is a <a href="https://en.wikipedia.org/wiki/Prototype-based_programming">prototypal</a>, <a href="https://en.wikipedia.org/wiki/Duck_typing">duck typed</a> language, and this has always allowed programmers to do something very similar just by adding a new property to an existing prototype. But this simple addition has major problem and should be avoided.
In fact <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain#Bad_practice_Extension_of_native_prototypes">you should never modify the prototype of types you don't own</a>, and that's why most libraries go out of their way to offer new functionalities to existing types without actually modifying those types.</p>
<p>Recent versions of JavaScript (i.e. ECMAScript 6) added a new primitive data type, <a href="https://developer.mozilla.org/en-US/docs/Glossary/symbol"><code>symbol</code></a>, which can be used to implement traits effectively<a href="#footnote1"><sup>[1]</sup></a>. A <code>symbol</code> is basically a unique identifier that can be used as a property and that will never collide with anything else.
In ECMAScript 6 they needed a way to expand standard types without breaking compatibility with existing code. That is why they introduced <code>symbol</code>, and they're indeed using it to implement traits. However, instead of advertising this new feature and making traits a first class citizen, they have let <code>symbol</code>s remain in the shadows.
The standard calls this feature <em>protocol</em>, instead of <em>trait</em>, and one of several examples is the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols">iteration protocol</a>.</p>
<p>Besides the lack of guidelines and good examples, another issue makes it tough to use <code>symbol</code>s as traits: a lack of good syntax to do so.</p>
<p>But enough talking!
Let's look at an example.</p>
<h3 id="why-do-we-need-traits-an-example">Why do we need traits? An example</h3>
<p>Imagine that you need a serializer to convert pieces of data into a string that can be stored somewhere.</p>
<p><code>JSON.stringify()</code> is not good enough, as it doesn't support "complex" objects (try to stringify a circular object, a <code>RegExp</code>, a <code>Map</code> etc, and you'll see).</p>
<p>Well, let's write our own serialization function then.
We want to support <a href="https://developer.mozilla.org/en-US/docs/Glossary/Primitive">primitive data types</a> (<code>boolean</code>, <code>number</code>, <code>string</code> etc), <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects">built-in types</a> (<code>Array</code>, <code>Map</code>, <code>RegExp</code> etc), as well as the classes we or somebody else define.
Something might be impossible to serialize, like <code>Function</code>s or <code>Promise</code>s, and that's OK: we'll just throw an error if we're given to serialize one of these.</p>
<p>What we are trying to do, is to add a new serializing logic to most types, regardless of wether they're defined by us, by other people, or built-in in the language. This logic needs to be custom-written for each type.</p>
<p>We can achieve that by adding a new <code>serialize</code> method to everything. This way <code>var.serialize()</code> will return a serializable representation for any variable <code>var</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// for some primitive data types `JSON.stringify()` works just fine:</span>
<span class="nb">Boolean</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">serialize</span> <span class="o">=</span>
    <span class="nb">Number</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">serialize</span> <span class="o">=</span>
    <span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">serialize</span> <span class="o">=</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">};</span>

<span class="c1">// implementing `serialize` for some bult-in types</span>
<span class="nb">RegExp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">serialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="sb">`/</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">flags</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="p">};</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">serialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">values</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="p">(</span><span class="nx">item</span><span class="p">)=&gt;</span><span class="nx">item</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span> <span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="sb">`, `</span><span class="p">);</span>
    <span class="k">return</span> <span class="sb">`[</span><span class="si">${</span><span class="nx">values</span><span class="si">}</span><span class="sb">]`</span><span class="p">;</span>
<span class="p">};</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">serialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">properties</span> <span class="o">=</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">map</span><span class="p">(</span> <span class="p">([</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">])=&gt;</span>
            <span class="sb">`</span><span class="si">${</span><span class="nx">key</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">value</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span> <span class="p">);</span>
    <span class="k">return</span> <span class="sb">`{</span><span class="si">${</span><span class="nx">properties</span><span class="si">}</span><span class="sb">}`</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// implementing it for our custom types as well...</span>
<span class="kr">class</span> <span class="nx">Person</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">age</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">objects</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
    <span class="nx">serialize</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="sb">`Person(</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">age</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span><span class="si">}</span><span class="sb">){`</span> <span class="o">+</span>
            <span class="sb">`objects:</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span> <span class="o">+</span>
        <span class="sb">`}`</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Let's try it out...</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">peoro</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="s2">&quot;peoro&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
<span class="nx">peoro</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">a</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">re</span><span class="o">:</span><span class="sr">/^...$/g</span> <span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">peoro</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span> <span class="p">);</span>
</pre></div>
</td></tr></table>

<p>It prints:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Person(&quot;peoro&quot;, 32){objects:[{&quot;a&quot;: true,&quot;re&quot;: /^...$/g}]}
</pre></div>
</td></tr></table>

<p>Which is exactly what we wanted.
Amazing! Isn't it?
Well, not really.</p>
<p>We modified existing types we have no ownership of. That's called <a href="https://en.wikipedia.org/wiki/Monkey_patch">monkey patching</a>. It seems to work, but will give many serious problems as soon as somebody tries to use our serializer in a real application. Let's see a few:</p>
<ul>
<li>Try to serialize the object <code>{serialize:true}</code>: you'll get an error, since the <code>serialize</code> property of such object overrides <code>Object.prototype.serialize</code>.</li>
<li>Somebody else might define a different <code>serialize</code> method to serialize objects in a different format. Our serializer and theirs will be incompatible; if both are loaded in the same project (even as an indirect dependency) things will break in unexpected ways.</li>
<li>Try to iterate using <code>for...in</code> on a plain object: you'll iterate over the <code>Object.prototype</code>'s <code>serialize</code> property as well. This is gonna break the majority of existing code.</li>
</ul>
<p>The problem with monkey patching is that we're modifying global data: any function that wasn't written by us might rely on assumptions on existing objects that we might have broken,</p>
<p>This is the reason why libraries (including the huge ones that could impose their own standards - think of jQuery or lodash) won't modify built-in types. They would rather expose free functions (like lodash), or wrappers to encapsulate existing objects and add new methods only to their wrappers (like jQuery).</p>
<p>It's important to note that the solutions chosen by these libraries are quite limited: it's hard to specialize the behavior for wrappers and free functions. When you write them, you might hardcode a waterfall of <code>if</code>s to support a bunch of types, but later it cannot be extended. You won't be able to make their functions work with your custom types.</p>
<p>As an exercise, try to define a <code>serialize</code> function able to serialize several types without modifying existing objects nor their prototype. Then try to make it possible for the users of your library to add support for their own types, or to existing third-party objects.
Most of the solutions you might consider (e.g. using a <code>Type â†’ serializationFunction</code> map) would likely result in further unexpected problems.</p>
<p>This is where <code>symbol</code>s come in our assistance.
Welcome to the world of traits.</p>
<h2 id="how-to-implement-traits-in-javascript">How to implement traits in JavaScript</h2>
<p>A <code>symbol</code> is a primitive type introduced in ES6 which can be used as an object's key, and it's guaranteed to never ever clash with anything else: if <code>sym</code> is a <code>symbol</code>, the only way to access <code>object[sym]</code> is by using <code>sym</code> itself. Besides, <code>for...in</code> loops won't iterate over <code>symbol</code>s.</p>
<p>It's not a coincidence that <code>symbol</code>s work this way: they were added to the standard for the exact same reason why we need them.
ECMAScript 6 wanted to add new functionalities to existing types, but, as we've seen, it was impossible to do so without risking to break existing code.</p>
<p>For an example of how the standard is using them, look at the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols">iterable protocol</a>. A new symbol <code>Symbol.iterator</code> was introduced. The types that implement it can be iterated over using the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...of"><code>for...of</code> syntax</a>. Such symbol is implemented for <code>Array</code>, <code>TypedArray</code>, <code>String</code>, <code>Map</code>, <code>Set</code>, and you can implement it on your own types as well.</p>
<p>Our serializer should instantiate a <code>serialize</code> symbol, use it, and expose it for everybody to use:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">serialize</span> <span class="o">=</span> <span class="nx">Symbol</span><span class="p">();</span>

<span class="nb">Boolean</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">serialize</span><span class="p">]</span> <span class="o">=</span>
    <span class="nb">Number</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">serialize</span><span class="p">]</span> <span class="o">=</span>
    <span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">serialize</span><span class="p">]</span> <span class="o">=</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">};</span>
<span class="nb">RegExp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">serialize</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">};</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">serialize</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">};</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">serialize</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">};</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="p">[</span><span class="nx">serialize</span><span class="p">]()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Person</span><span class="p">,</span>
    <span class="nx">serialize</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<p>Our users can then implement the same <code>serialize</code> symbol on their types and use it.
No other existing piece of code will be affected.</p>
<p><code>symbol</code>s aren't the final answer though...
They're very powerful and are used by the standard to implement traits, but the amount of documentation covering them is miniscule. Virtually no guidelines, very few tutorials or articles explaining what they are and how to use them.
The result is that very few modules are using them.</p>
<p>A further problem concerns their syntax: there's no special syntax to use them, and in some cases this becomes a pain.</p>
<p>Imagine a <a href="https://www.npmjs.com/package/lodash-traits">lodash-traits</a> library that offers and implement a <code>symbol</code> for each lodash function.</p>
<p>You wouldn't be able to just do:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;lodash-traits&#39;</span><span class="p">);</span>
<span class="c1">// returning an object&#39;s values (numbers), sorted and without duplicates</span>
<span class="k">return</span> <span class="nx">object</span>  <span class="c1">// { a:7, b:12, c:4, d:7, e:1 }</span>
    <span class="p">.</span><span class="nx">values</span><span class="p">()</span>    <span class="c1">// [7, 12, 4, 7, 1]</span>
    <span class="p">.</span><span class="nx">sortBy</span><span class="p">()</span>    <span class="c1">// [1, 4, 7, 7, 12]</span>
    <span class="p">.</span><span class="nx">uniq</span><span class="p">()</span>      <span class="c1">// [1, 4, 7, 12]</span>
</pre></div>
</td></tr></table>

<p>You'd have to do...</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;lodash-traits&#39;</span><span class="p">);</span>
<span class="c1">// returning an object&#39;s values (numbers), sorted and without duplicates</span>
<span class="k">return</span> <span class="nx">object</span>   <span class="c1">// { a:7, b:12, c:4, d:7, e:1 }</span>
    <span class="p">[</span><span class="nx">_</span><span class="p">.</span><span class="nx">values</span><span class="p">]()</span>  <span class="c1">// [7, 12, 4, 7, 1]</span>
    <span class="p">[</span><span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">]()</span>  <span class="c1">// [1, 4, 7, 7, 12]</span>
    <span class="p">[</span><span class="nx">_</span><span class="p">.</span><span class="nx">uniq</span><span class="p">]()</span>    <span class="c1">// [1, 4, 7, 12]</span>
</pre></div>
</td></tr></table>

<p>And this becomes uncomfortable pretty fast.</p>
<p>This is why, in addition to traits, we're proposing a new syntax, designed to aid trait development.</p>
<h3 id="a-better-syntax-for-traits">A better syntax for traits</h3>
<p>We're proposing a language extension, the <a href="https://straits.github.io/syntax/">straits syntax</a>, to be able to write the previous snippet the following way:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">use</span> <span class="nx">traits</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;lodash-traits&#39;</span><span class="p">);</span>
<span class="c1">// returning an object&#39;s values (numbers), sorted and without duplicates</span>
<span class="k">return</span> <span class="nx">object</span>  <span class="c1">// { a:7, b:12, c:4, d:7, e:1 }</span>
    <span class="p">.</span><span class="o">*</span><span class="nx">values</span><span class="p">()</span>   <span class="c1">// [7, 12, 4, 7, 1]</span>
    <span class="p">.</span><span class="o">*</span><span class="nx">sortBy</span><span class="p">()</span>   <span class="c1">// [1, 4, 7, 7, 12]</span>
    <span class="p">.</span><span class="o">*</span><span class="nx">uniq</span><span class="p">()</span>     <span class="c1">// [1, 4, 7, 12]</span>
</pre></div>
</td></tr></table>

<p>What does it mean?</p>
<p><code>use traits * from traitSet;</code> means that we will be looking for symbols inside the object <code>traitSet</code>. We call <code>traitSet</code> a <em>trait set</em>.
<code>object.*key</code> means that we're accessing <code>object</code> with the symbol called <code>key</code> found in the trait set in use.</p>
<p>In pratice:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">use</span> <span class="nx">traits</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">traitSet</span><span class="p">;</span>
<span class="nx">object</span><span class="p">.</span><span class="o">*</span><span class="nx">key</span>
</pre></div>
</td></tr></table>

<p>Is roughly equivalent to:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">object</span><span class="p">[</span> <span class="nx">traitSet</span><span class="p">.</span><span class="nx">key</span> <span class="p">]</span>
</pre></div>
</td></tr></table>

<p>We would write the serialization part of our module the following way:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">traits</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">serialize</span><span class="o">:</span> <span class="nx">Symbol</span><span class="p">()</span>
<span class="p">};</span>

<span class="c1">// enabling .* for our traits</span>
<span class="nx">use</span> <span class="nx">traits</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">traits</span><span class="p">;</span>

<span class="c1">// implementing .*serialize() for `Number`</span>
<span class="nb">Number</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="o">*</span><span class="nx">serialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span> <span class="p">};</span>
<span class="c1">// ...</span>

<span class="c1">// using .*serialize()</span>
<span class="kr">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="nx">value</span><span class="p">.</span><span class="o">*</span><span class="nx">serialize</span><span class="p">();</span>  <span class="c1">// &quot;7&quot;</span>
</pre></div>
</td></tr></table>

<p>This syntax is compatible with the standard <code>symbol</code>s built-in in ECMAScript 6:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">use</span> <span class="nx">traits</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">Symbol</span><span class="p">;</span>

<span class="c1">// this is `[][Symbol.iterator]`</span>
<span class="p">[].</span><span class="o">*</span><span class="nx">iterator</span>
</pre></div>
</td></tr></table>

<p>It's possible to use traits from multiple trait sets at the same time, and we'll receive an error in case a trait is duplicated or missing.</p>
<p>This syntax is meant to...</p>
<ul>
<li>Turn <code>symbol</code>s into first class citizens of JavaScript.</li>
<li>Make traits easier both to declare and use.</li>
<li>Avoid conflicts and mistakes between variables in scope and traits.</li>
</ul>
<p>It's currently possible to develop code using this syntax, and to convert it into standard JavaScript using a babel plugin: <a href="https://www.npmjs.com/package/straits-babel"><code>straits-babel</code></a>.</p>
<h2 id="article-conclusion-and-straits-introduction">Article conclusion and straits introduction</h2>
<p>Hopefully it's now clear why there's a need for traits, how to create them using <code>symbol</code>s, prototypal inheritance and duck typing, and how to use them comfortably.</p>
<p>The <a href="https://straits.github.io/">straits</a> project offers a number of common functions to aid in the declaration and usage of <code>symbol</code>s, traits and trait sets.</p>
<p>If you want to give it a chance, just run <code>npm init @straits</code> in an empty directory: it will set up a project ready to use the new syntax. Then run <code>npm install</code> and everything will be ready: <code>npm start</code> will run <code>src/index.js</code>, a hello-world ready to be played with.</p>
<p>If you like traits, you to just use the <a href="https://straits.github.io/syntax/">straits syntax</a> in your project.
It will be completely transparent to your users, since the code you'll release or publish on npm will be transpiled: standard, regular JavaScript. The users of your module are free to choose whether they want to use use this syntax as well, or rather use <code>symbol</code>s manually or even through free-functions.
Give a look at <a href="https://github.com/peoro/lodash-traits/blob/master/test/index.js">lodash-traits' <code>test/index.js</code></a> to see how a module using traits can be used with or without using the straits syntax.</p>
<p>If you want to give a look at some projects relying on traits, check out:</p>
<ul>
<li><a href="https://www.npmjs.com/package/lodash-traits">lodash-traits</a>: a trait set wrapping <a href="https://lodash.com/">lodash</a> functions.</li>
<li><a href="https://www.npmjs.com/package/chalk-traits">chalk-traits</a>: a trait set wrapping <a href="https://www.npmjs.com/package/chalk">chalk</a> functions.</li>
<li><a href="https://www.npmjs.com/package/scontainers">Scontainers</a>: a powerful, high performance library (although still in alpha) to work with collections of data.</li>
<li><a href="https://www.npmjs.com/package/esast">ESAST</a>: a library to manipulate JavaScript AST in a comfortable way (i.e. without wrapper objects).</li>
</ul>
<hr />
<p>1: <span id="footnote1"></span> Alternatively, <code>WeakMap</code> could be used to implement traits. <code>WeakMap</code> was introduced in ECMAScript 6 as well, and we decided against it since the standard uses <code>symbol</code>s to implement traits.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../quickstart/" title="Quickstart" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Quickstart
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>